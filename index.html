<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Ø¯Ù„ÙŠÙ„ Ù‚Ø±ÙŠØ© Ø´Ø¨Ø±Ø§Ø±ÙŠØ³ â€” Ø£Ø±Ù‚Ø§Ù… ÙˆØ®Ø¯Ù…Ø§Øª</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700&display=swap" rel="stylesheet">
<style>
  :root{
    --bg:#f8f9fa;
    --card:#ffffff;
    --text:#00629e;
    --muted:#718096;
    --accent:#052144; /* ÙƒØ­Ù„ÙŠ ØºØ§Ù…Ù‚ */
    --accent-dark:#052144;
    --accent-light:#bee3f8;
    --danger:#e53e3e;
    --font-main: 'Tajawal', "Segoe UI", Tahoma, Arial, sans-serif;
  }
  html,body{height:100%;margin:0;font-family: var(--font-main);direction:rtl}
  body{background:var(--bg);color:var(--text);transition:background .25s,color .25s}
  .dark{--bg:#1a202c;--card:#2d3748;--text:#f7fafc;--muted:#a0aec0;--accent:#1361a0;--accent-dark:#3182ce;--accent-light:#ebf8ff}

  /* top bar */
  header{position:sticky;top:0;z-index:40;background:var(--accent-dark);color:white;padding:12px 16px;display:flex;align-items:center;justify-content:space-between;gap:12px;box-shadow:0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06)}
  .brand{display:flex;gap:12px;align-items:center}
  .logo{width:44px;height:44px;border-radius:8px;background:rgba(255,255,255,0.12);display:flex;align-items:center;justify-content:center;font-weight:700;font-family: var(--font-main);font-size: 1.4rem}
  header h1{font-size:18px;margin:0;font-weight:700}
  /* small left toggle */
  .left-controls{display:flex;align-items:center;gap:8px}
  .theme-toggle{width:40px;height:36px;border-radius:8px;border:0;background:rgba(255,255,255,0.12);color:white;cursor:pointer;font-weight:700;font-size:1.1rem}

  /* layout */
  .wrap{max-width:1100px;margin:20px auto;padding:0 16px}
  .hero{background:var(--card);padding:18px;border-radius:12px;box-shadow:0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);display:flex;gap:16px;align-items:center;flex-wrap:wrap;margin-bottom:20px}
  .hero .text{flex:1;min-width:220px}
  .hero h2{margin:0 0 6px;font-size:20px;font-weight:700;color:var(--accent-dark)}
  .hero p{margin:0;color:var(--muted);line-height:1.6;font-size:15px}

  /* search bar */
  .search-container{width:100%;margin:20px 0;position:relative}
  .search-input{width:100%;padding:12px 16px;padding-left:45px;border-radius:8px;border:1px solid rgba(0,0,0,0.1);font-family: var(--font-main);font-size:15px;background-color:var(--card);color:var(--text);box-shadow:0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06)}
  .search-input:focus{outline:none;border-color:var(--accent);box-shadow:0 0 0 3px var(--accent-light)}
  .search-icon{position:absolute;right:15px;top:50%;transform:translateY(-50%);color:var(--muted)}

  /* grid */
  .grid{display:grid;grid-template-columns: 1fr 380px;gap:16px;margin-top:16px}
  @media(max-width:920px){ .grid{grid-template-columns:1fr} }

  /* left column (lists) */
  .sections{display:flex;flex-direction:column;gap:14px}
  .section{background:var(--card);padding:12px;border-radius:10px;box-shadow:0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);border:1px solid rgba(0,0,0,0.05)}
  .section h3{margin:0 0 8px;color:var(--accent-dark);font-weight:700;font-size:16px;padding-bottom:8px;border-bottom:1px solid rgba(0,0,0,0.05)}
  .list{display:flex;flex-direction:column;gap:8px}
  .item{display:flex;justify-content:space-between;align-items:center;padding:10px;border-radius:8px;background:var(--bg);gap:10px;border:1px solid rgba(0,0,0,0.05);transition:all 0.2s}
  .item:hover{transform:translateY(-2px);box-shadow:0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06)}
  .item .meta{display:flex;flex-direction:column;gap:4px}
  .item .meta .name{font-weight:700;color:var(--accent-dark)}
  .item .meta .addr{font-size:13px;color:var(--muted);line-height:1.5}
  .item .actions{display:flex;gap:6px;align-items:center}
  .btn{border:0;padding:8px 12px;border-radius:6px;cursor:pointer;font-weight:700;font-family: var(--font-main);font-size:13px;transition:all 0.2s}
  .btn.edit{background:var(--accent-dark);color:white}
  .btn.edit:hover{background:var(--accent)}
  .btn.delete{background:transparent;border:1px solid var(--danger);color:var(--danger)}
  .btn.delete:hover{background:rgba(229, 62, 62, 0.1)}
  .tel{background:var(--accent-dark);color:white;padding:8px 12px;border-radius:6px;text-decoration:none;font-weight:700;font-family: var(--font-main);font-size:13px;transition:all 0.2s}
  .tel:hover{background:var(--accent);transform:translateY(-1px)}

  /* right column (form + stats) */
  aside .card{background:var(--card);padding:16px;border-radius:10px;box-shadow:0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);border:1px solid rgba(0,0,0,0.05)}
  label{display:block;font-size:13px;color:var(--muted);margin-top:12px;margin-bottom:4px;font-weight:500}
  input,select,textarea{width:100%;padding:10px 12px;border-radius:6px;border:1px solid rgba(0,0,0,0.1);background:transparent;color:var(--text);resize:vertical;font-family: var(--font-main);font-size:14px;transition:all 0.2s}
  input:focus, select:focus, textarea:focus{outline:none;border-color:var(--accent);box-shadow:0 0 0 3px var(--accent-light)}
  textarea{min-height:80px}
  .primary{background:var(--accent-dark);color:white;border:0;padding:12px;border-radius:8px;margin-top:16px;cursor:pointer;font-weight:800;font-family: var(--font-main);width:100%;transition:all 0.2s}
  .primary:hover{background:var(--accent);transform:translateY(-1px)}
  .muted{color:var(--muted);font-size:13px}

  /* footer */
  footer{margin-top:24px;text-align:center;color:var(--muted);font-size:13px;padding:16px 12px;border-top:1px solid rgba(0,0,0,0.05)}

  /* small helpers */
  .row{display:flex;gap:8px}
  .pill{padding:6px 12px;border-radius:999px;background:var(--accent-light);font-weight:700;color:var(--accent-dark);font-size:13px}
  .empty{color:var(--muted);padding:16px;text-align:center;font-size:14px}
  hr{border:0;height:1px;background:rgba(0,0,0,0.05);margin:12px 0}
</style>
</head>
<body>

<header>
  <div class="brand">
    <div class="logo">âš¡</div>
    <div>
      <h1>Ø¯Ù„ÙŠÙ€Ù„ Ù‚Ø±ÙŠÙ€Ø© Ø´Ø¨Ø±Ø§Ø±ÙŠÙ€Ù€Ù€Ù€Ù€Ù€Ù€Ø³</h1>
      <div class="muted" style="font-size:13px">Ø£Ø±Ù‚Ø§Ù… Ø§Ù„Ø·ÙˆØ§Ø±Ø¦ ÙˆØ§Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© ÙÙŠ Ø§Ù„Ù‚Ø±ÙŠØ©</div>
    </div>
  </div>

  <div class="left-controls" style="margin-left:auto;">
    <button id="themeBtn" class="theme-toggle" title="ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„ÙˆØ¶Ø¹">ğŸŒ™</button>
  </div>
</header>

<main class="wrap">
  <div class="hero">
    <div class="text">
      <h2>Ù…Ø±Ø­Ø¨Ù‹Ø§ Ø¨Ùƒ ÙÙŠ Ø¯Ù„ÙŠÙ„ Ù‚Ø±ÙŠÙ€Ø© Ø´Ø¨Ø±Ø§Ø±ÙŠÙ€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ø³</h2>
      <p>Ù‡Ù†Ø§ Ø³ÙˆÙ ØªØ¬Ø¯ Ø£Ø±Ù‚Ø§Ù… Ø§Ù„Ø¥Ø³Ø¹Ø§ÙØŒ Ø§Ù„Ù…Ø·Ø§ÙÙŠØŒ Ø§Ù„ÙƒÙ‡Ø±Ø¨Ø§Ø¡ØŒ Ø§Ù„Ù…ÙŠØ§Ù‡ØŒ Ø§Ù„Ø£Ø·Ø¨Ø§Ø¡ØŒ Ø§Ù„ØµÙŠØ¯Ù„ÙŠØ§ØªØŒ Ø³ÙŠØ§Ø±Ø§Øª Ø§Ù„Ù†Ù‚Ù„ØŒ ÙˆØ§Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ø­ÙƒÙˆÙ…ÙŠØ© â€” Ø£Ø¶Ù ÙˆØ¹Ø¯Ù‘Ù„ Ø¨Ø³Ù‡ÙˆÙ„Ø©.</p>
      <div style="margin-top:12px" class="row">
        <div class="pill">Ø§Ù„Ù…Ù‡Ù†Ø¯Ø³</div>
        <div class="pill">Ø£Ø­Ù…Ø¯ Ø§Ù„Ù€Ø¹Ø·Ø§Ø±</div>
        <div class="pill">ÙŠØ±Ø­Ø¨ Ø¨Ùƒ </div>
      </div>
    </div>
    <div style="min-width:160px;text-align:center">
      <img src="1.jpg" alt="" id="heroImg" style="width:140px;height:140px;border-radius:12px;background:linear-gradient(180deg,var(--accent-dark),var(--accent));display:inline-block;box-shadow:0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06)">
    </div>
  </div>

  <!-- New Search Bar -->
  <div class="search-container">
    <input id="globalSearch" class="search-input" type="search" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ø®Ø¯Ù…Ø©ØŒ Ø±Ù‚Ù…ØŒ Ø£Ùˆ Ø§Ø³Ù…..." aria-label="Ø¨Ø­Ø«">
    <div class="search-icon">ğŸ”</div>
  </div>

  <div class="grid">
    <!-- left: lists -->
    <div class="sections" id="listsColumn">
      <!-- Emergency -->
      <section class="section" id="sec-emergency">
        <h3>ğŸš¨ Ø·ÙˆØ§Ø±Ø¦</h3>
        <div class="list" id="list-emergency"></div>
      </section>

      <!-- Doctors -->
      <section class="section" id="sec-doctors">
        <h3>ğŸ©º Ø£Ø·Ø¨Ø§Ø¡</h3>
        <div class="list" id="list-doctors"></div>
      </section>

      <!-- Pharmacies -->
      <section class="section" id="sec-pharmacies">
        <h3>ğŸ’Š ØµÙŠØ¯Ù„ÙŠØ§Øª</h3>
        <div class="list" id="list-pharmacies"></div>
      </section>

      <!-- Electricity -->
      <section class="section" id="sec-electric">
        <h3>âš¡ ÙƒÙ‡Ø±Ø¨Ø§Ø¡</h3>
        <div class="list" id="list-electric"></div>
      </section>

      <!-- Water -->
      <section class="section" id="sec-water">
        <h3>ğŸ’§ Ù…ÙŠØ§Ù‡</h3>
        <div class="list" id="list-water"></div>
      </section>

      <!-- Transport -->
      <section class="section" id="sec-transport">
        <h3>ğŸ›º Ø¹Ø±Ø¨ÙŠØ§Øª  / ØªÙˆÙƒØªÙˆÙƒ</h3>
        <div class="list" id="list-transport"></div>
      </section>

      <!-- Gov -->
      <section class="section" id="sec-gov">
        <h3>ğŸ›ï¸ Ø®Ø¯Ù…Ø§Øª Ø­ÙƒÙˆÙ…ÙŠØ©</h3>
        <div class="list" id="list-gov"></div>
      </section>

      <!-- Others -->
      <section class="section" id="sec-others">
        <h3>ğŸ”§ Ø®Ø¯Ù…Ø§Øª ØµÙŠØ§Ù†Ø© ÙˆÙˆØ±Ø´</h3>
        <div class="list" id="list-others"></div>
      </section>
    </div>

    <!-- right: form + stats -->
    <aside>
      <div class="card">
        <h3>â• Ø¥Ø¶Ø§ÙØ© / ØªØ¹Ø¯ÙŠÙ„ Ø®Ø¯Ù…Ø©</h3>

        <label>Ø§Ù„ÙØ¦Ø©</label>
        <select id="inputCategory">
          <option value="emergency">ğŸš¨ Ø·ÙˆØ§Ø±Ø¦</option>
          <option value="doctors">ğŸ©º Ø£Ø·Ø¨Ø§Ø¡</option>
          <option value="pharmacies">ğŸ’Š ØµÙŠØ¯Ù„ÙŠØ§Øª</option>
          <option value="electric">âš¡ ÙƒÙ‡Ø±Ø¨Ø§Ø¡</option>
          <option value="water">ğŸ’§ Ù…ÙŠØ§Ù‡</option>
          <option value="transport">ğŸ›º Ø¹Ø±Ø¨ÙŠØ§Øª  / ØªÙˆÙƒØªÙˆÙƒ</option>
          <option value="gov">ğŸ›ï¸ Ø®Ø¯Ù…Ø§Øª Ø­ÙƒÙˆÙ…ÙŠØ©</option>
          <option value="others">ğŸ”§ Ø®Ø¯Ù…Ø§Øª ØµÙŠØ§Ù†Ø©</option>
        </select>

        <label>Ø§Ù„Ø§Ø³Ù… / Ø§Ù„Ø¬Ù‡Ø©</label>
        <input id="inputName" placeholder="Ù…Ø«Ù„: Ø¯. Ø£Ø­Ù…Ø¯ Ø¹Ù„ÙŠ / ØµÙŠØ¯Ù„ÙŠØ© Ø§Ù„Ø´ÙØ§Ø¡" />

        <label>Ø§Ù„Ø±Ù‚Ù… (ÙŠÙÙØ¶Ù„ Ø¨Ø¯ÙˆÙ† ÙØ±Ø§ØºØ§Øª)</label>
        <input id="inputPhone" placeholder="01012345678" />

        <label>Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</label>
        <input id="inputAddress" placeholder="Ø´Ø§Ø±Ø¹ Ø§Ù„ÙˆØ­Ø¯Ø©ØŒ Ø¨Ø¬ÙˆØ§Ø± Ø§Ù„Ù…Ø³Ø¬Ø¯" />

        <label>Ù…Ù„Ø§Ø­Ø¸Ø©</label>
        <textarea id="inputNote" placeholder="Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ø¹Ù…Ù„ØŒ Ø®Ø¯Ù…Ø© 24 Ø³Ø§Ø¹Ø©ØŒ Ø¥Ù„Ø®"></textarea>

        <input type="hidden" id="editingId" value="">

        <button id="saveBtn" class="primary">Ø­ÙØ¸</button>
        <button id="clearBtn" style="margin-top:8px;background:transparent;border:1px solid rgba(0,0,0,0.1);padding:10px;border-radius:6px;cursor:pointer;font-family: var(--font-main);width:100%;transition:all 0.2s">Ù…Ø³Ø­ Ø§Ù„Ø­Ù‚ÙˆÙ„</button>
      </div>

      <div class="card" style="margin-top:16px">
        <h3>ğŸ” Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª ÙˆØ³Ø±Ø¹Ø©</h3>
        <div class="muted" id="stats">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>
        <hr />
        <div style="font-size:13px;color:var(--muted)">Ø§Ø¨Ø­Ø« Ø¨Ø³Ø±Ø¹Ø© Ø¹Ø¨Ø± Ù…Ø±Ø¨Ø¹ Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ø¹Ù„ÙˆÙŠ Ø£Ùˆ Ø§Ø³ØªØ®Ø¯Ù… ÙÙ„ØªØ± Ø§Ù„ÙØ¦Ø©.</div>
      </div>

      <div class="card" style="margin-top:16px;text-align:center">
        <div class="muted" style="font-size:13px">Ø­ÙØ¸ Ù…Ø­Ù„ÙŠÙ‹Ø§ ÙÙŠ Ø¬Ù‡Ø§Ø²Ùƒ â€” Ù„Ø§ ÙŠØ­ØªØ§Ø¬ ØªØ³Ø¬ÙŠÙ„</div>
        <div style="margin-top:10px;font-size:13px;color:var(--muted)">Made by Eng. Ahmed Elattar</div>
      </div>
    </aside>
  </div>

  <footer>
    Â© <span id="year"></span> Ø¯Ù„ÙŠÙ„ Ø´Ø¨Ø±Ø§Ø±ÙŠØ³ â€” ÙƒÙ„ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø©
  </footer>
</main>

<script>
/* ------------- Data & Storage ------------- */
const STORAGE_KEY = 'shbraris_contacts_v1';

/* default sample data */
const DEFAULT = [
  {id:idGen(), cat:'emergency', name:'Ø§Ù„Ø¥Ø³Ø¹Ø§Ù', phone:'123', address:'Ø®Ø· Ø·ÙˆØ§Ø±Ø¦', note:'Ø®Ø¯Ù…Ø© 24 Ø³Ø§Ø¹Ø©'},
  {id:idGen(), cat:'emergency', name:'Ø§Ù„Ù…Ø·Ø§ÙÙŠ', phone:'180', address:'Ù…Ø±ÙƒØ² Ø§Ù„Ø¥Ø·ÙØ§Ø¡', note:''},
  {id:idGen(), cat:'electric', name:'Ø¨Ù„Ø§Øº ÙƒÙ‡Ø±Ø¨Ø§Ø¡', phone:'121', address:'Ø§Ù„Ù…Ù†Ø·Ù‚Ø©', note:'Ø¨Ù„Ø§Øº Ø§Ù„Ø£Ø¹Ø·Ø§Ù„'},
  {id:idGen(), cat:'water', name:'Ø´Ø±ÙƒØ© Ø§Ù„Ù…ÙŠØ§Ù‡', phone:'125', address:'Ù…ÙƒØªØ¨ Ø§Ù„Ù…ÙŠØ§Ù‡', note:''},
  {id:idGen(), cat:'pharmacies', name:'ØµÙŠØ¯Ù„ÙŠØ© Ø§Ù„Ø´ÙØ§Ø¡', phone:'01012345678', address:'Ø´Ø§Ø±Ø¹ Ø§Ù„Ø³ÙˆÙ‚', note:'Ù…Ø³Ø§Ø¡Ù‹ Ø­ØªÙ‰ 10'},
  {id:idGen(), cat:'transport', name:'Ù†Ù‚Ù„ - Ø¹Ù…Ø§Ø¯', phone:'01098765432', address:'Ø®Ø¯Ù…Ø© Ù†Ù‚Ù„ Ø¯Ø§Ø®Ù„ Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø©', note:''},
  {id:idGen(), cat:'doctors', name:'Ø¯. Ø£Ø­Ù…Ø¯ Ø¹Ù„ÙŠ', phone:'01055556666', address:'Ø¹ÙŠØ§Ø¯Ø© Ø¹Ø§Ù…Ø©', note:'Ø£ÙˆÙ‚Ø§Øª 9-1'}
];

let contacts = load();

/* ------------- Helpers ------------- */
function idGen(){ return 'id'+Math.random().toString(36).slice(2,9) }
function save(){ localStorage.setItem(STORAGE_KEY, JSON.stringify(contacts)); renderAll(); updateStats(); }
function load(){
  try{
    const raw = localStorage.getItem(STORAGE_KEY);
    if(!raw) { localStorage.setItem(STORAGE_KEY, JSON.stringify(DEFAULT)); return DEFAULT.slice(); }
    return JSON.parse(raw);
  }catch(e){ localStorage.setItem(STORAGE_KEY, JSON.stringify(DEFAULT)); return DEFAULT.slice(); }
}
function findById(id){ return contacts.find(c=>c.id===id) }
function removeById(id){ contacts = contacts.filter(c=>c.id!==id); save(); }

/* ------------- Rendering ------------- */
const cats = {
  emergency: 'list-emergency',
  doctors: 'list-doctors',
  pharmacies: 'list-pharmacies',
  electric: 'list-electric',
  water: 'list-water',
  transport: 'list-transport',
  gov: 'list-gov',
  others: 'list-others'
};

function renderAll(filter=''){
  // clear lists
  Object.values(cats).forEach(elId => document.getElementById(elId).innerHTML='');

  const q = filter.trim().toLowerCase();

  contacts.forEach(item=>{
    // search filter
    if(q){
      const hay = (item.name+' '+(item.address||'')+' '+(item.phone||'')+' '+(item.note||'')+' '+item.cat).toLowerCase();
      if(!hay.includes(q)) return;
    }
    const containerId = cats[item.cat] || 'list-others';
    const cont = document.getElementById(containerId);
    const div = document.createElement('div');
    div.className = 'item';
    div.dataset.id = item.id;
    div.innerHTML = `
      <div class="meta">
        <div class="name">${escapeHtml(item.name)}</div>
        <div class="addr">${escapeHtml(item.address || '')}${item.note? ' â€¢ ' + escapeHtml(item.note): ''}</div>
      </div>
      <div class="actions">
        <a class="tel" href="tel:${encodeURIComponent(item.phone)}">${escapeHtml(item.phone)}</a>
        <button class="btn edit" onclick="startEdit('${item.id}')">ØªØ¹Ø¯ÙŠÙ„</button>
        <button class="btn delete" onclick="confirmDelete('${item.id}')">Ø­Ø°Ù</button>
      </div>`;
    cont.appendChild(div);
  });

  // show empty notices
  Object.keys(cats).forEach(k=>{
    const el = document.getElementById(cats[k]);
    if(el.children.length===0){
      el.innerHTML = `<div class="empty">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Ù‡Ø°Ù‡ Ø§Ù„ÙØ¦Ø© Ø­ØªÙ‰ Ø§Ù„Ø¢Ù†.</div>`;
    }
  });
}

/* ------------- CRUD actions ------------- */
const inputCategory = document.getElementById('inputCategory');
const inputName = document.getElementById('inputName');
const inputPhone = document.getElementById('inputPhone');
const inputAddress = document.getElementById('inputAddress');
const inputNote = document.getElementById('inputNote');
const editingId = document.getElementById('editingId');
const saveBtn = document.getElementById('saveBtn');
const clearBtn = document.getElementById('clearBtn');

saveBtn.addEventListener('click', ()=>{
  const cat = inputCategory.value;
  const name = inputName.value.trim();
  const phone = inputPhone.value.trim();
  const addr = inputAddress.value.trim();
  const note = inputNote.value.trim();
  if(!name || !phone){ alert('Ù…Ù† ÙØ¶Ù„Ùƒ Ø§Ù…Ù„Ø£ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©: Ø§Ù„Ø§Ø³Ù… ÙˆØ§Ù„Ø±Ù‚Ù…'); return; }

  const id = editingId.value;
  if(id){
    // update
    const obj = findById(id);
    if(obj){
      obj.cat = cat; obj.name = name; obj.phone = phone; obj.address = addr; obj.note = note;
      editingId.value = '';
      saveBtn.textContent = 'Ø­ÙØ¸';
    }
  } else {
    // create
    contacts.unshift({id:idGen(), cat, name, phone, address:addr, note});
  }
  // clear form
  inputCategory.value='emergency'; inputName.value=''; inputPhone.value=''; inputAddress.value=''; inputNote.value='';
  save();
});

clearBtn.addEventListener('click', ()=>{
  editingId.value=''; inputCategory.value='emergency'; inputName.value=''; inputPhone.value=''; inputAddress.value=''; inputNote.value='';
  saveBtn.textContent = 'Ø­ÙØ¸';
});

function startEdit(id){
  const obj = findById(id);
  if(!obj) return alert('Ø§Ù„Ø¨Ù†Ø¯ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯');
  inputCategory.value = obj.cat;
  inputName.value = obj.name;
  inputPhone.value = obj.phone;
  inputAddress.value = obj.address || '';
  inputNote.value = obj.note || '';
  editingId.value = id;
  saveBtn.textContent = 'ØªØ­Ø¯ÙŠØ«';
  window.scrollTo({top:0,behavior:'smooth'});
}

function confirmDelete(id){
  const obj = findById(id);
  if(!obj) return;
  if(confirm(`Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù "${obj.name}" Ù†Ù‡Ø§Ø¦ÙŠÙ‹Ø§ØŸ`)){
    removeById(id);
  }
}

/* ------------- Search ------------- */
const globalSearch = document.getElementById('globalSearch');
globalSearch.addEventListener('input', ()=> renderAll(globalSearch.value));

/* ------------- Theme ------------- */
const themeBtn = document.getElementById('themeBtn');
function applyTheme(t){
  if(t==='dark') document.body.classList.add('dark'), themeBtn.textContent='â˜€';
  else document.body.classList.remove('dark'), themeBtn.textContent='ğŸŒ™';
}
themeBtn.addEventListener('click', ()=>{
  const isDark = document.body.classList.toggle('dark');
  themeBtn.textContent = isDark ? 'â˜€' : 'ğŸŒ™';
  localStorage.setItem('shbr_theme', isDark ? 'dark' : 'light');
});

/* ------------- Stats & init ------------- */
function updateStats(){
  const total = contacts.length;
  const per = {};
  contacts.forEach(c=> per[c.cat] = (per[c.cat]||0)+1);
  const parts = Object.keys(cats).map(k=> `${k}: ${per[k]||0}`).join(' â€¢ ');
  document.getElementById('stats').textContent = `Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø³Ø¬Ù„Ø§Øª: ${total} â€¢ ØªÙˆØ²ÙŠØ¹: ${parts.replace(/([a-z_]+)/g, (m)=> mapCat(m))}`;
}
function mapCat(key){
  const map = {emergency:'Ø·ÙˆØ§Ø±Ø¦',doctors:'Ø£Ø·Ø¨Ø§Ø¡',pharmacies:'ØµÙŠØ¯Ù„ÙŠØ§Øª',electric:'ÙƒÙ‡Ø±Ø¨Ø§Ø¡',water:'Ù…ÙŠØ§Ù‡',transport:'Ù†Ù‚Ù„',gov:'Ø­ÙƒÙˆÙ…ÙŠ',others:'Ø£Ø®Ø±Ù‰'};
  return map[key]||key;
}

/* ------------- Utilities ------------- */
function escapeHtml(s){ if(!s && s!==0) return ''; return String(s).replace(/[&<>"']/g, m=> ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'})[m]); }

/* ------------- Init ------------- */
document.getElementById('year').textContent = new Date().getFullYear();
(function init(){
  // apply stored theme
  const t = localStorage.getItem('shbr_theme') || 'light';
  applyTheme(t);

  renderAll();
  updateStats();

  // hero image colored square (just decorative)
  const heroImg = document.getElementById('heroImg');
  heroImg.style.boxShadow = '0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06)';
})();

</script>
</body>
</html>